<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard – Registrations</title>

<!-- Google Font -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
    :root {
        --accent: #00c6ff;
        --accent2: #7b61ff;
        --glass: rgba(255,255,255,0.07);
        --border: rgba(255,255,255,0.08);
        --shadow: rgba(0,0,0,0.5);
    }

    * { box-sizing: border-box; font-family: 'Inter', sans-serif; }

    body {
        margin: 0;
        background: linear-gradient(135deg, #02040f, #050b21, #0a1028);
        color: #dff6ff;
        overflow-x: hidden;
    }

    /* Animated Background Orbs */
    .orb {
        position: fixed;
        width: 400px; height: 400px;
        background: radial-gradient(circle, var(--accent2), transparent 70%);
        filter: blur(80px);
        opacity: 0.5;
        animation: float 12s infinite ease-in-out;
        z-index: -1;
    }
    .orb2 {
        background: radial-gradient(circle, var(--accent), transparent 70%);
        animation-duration: 18s;
    }
    @keyframes float {
        0% { transform: translate(0, 0); }
        50% { transform: translate(60px, -40px); }
        100% { transform: translate(0, 0); }
    }

    /* Header */
    header {
        padding: 20px 40px;
        border-bottom: 1px solid var(--border);
        background: rgba(255,255,255,0.04);
        backdrop-filter: blur(10px);
        position: sticky; top: 0;
    }
    header h1 {
        margin: 0;
        font-size: 1.8rem;
        font-weight: 800;
        background: linear-gradient(90deg,var(--accent),var(--accent2));
        background-clip: text;
        -webkit-background-clip: text;
        color: transparent;
    }

    /* Dashboard Grid */
    .container {
        padding: 30px;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 25px;
    }

    .card {
        padding: 20px;
        background: var(--glass);
        border: 1px solid var(--border);
        border-radius: 14px;
        box-shadow: 0 8px 25px var(--shadow);
        backdrop-filter: blur(14px);
        animation: fadeIn 0.8s ease forwards;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px);}
        to { opacity: 1; transform: translateY(0);}
    }

    /* Table */
    table {
        width: 100%;
        margin-top: 10px;
        border-collapse: collapse;
        overflow: hidden;
        border-radius: 10px;
    }
    th, td {
        padding: 12px;
        border-bottom: 1px solid var(--border);
    }
    th {
        background: rgba(255,255,255,0.08);
        text-align: left;
        font-weight: 700;
    }
    tr:hover {
        background: rgba(123,97,255,0.1);
        transition: 0.2s;
    }

    /* Loading */
    .loading {
        text-align: center;
        padding: 20px;
        font-size: 1.1rem;
        opacity: 0.7;
    }
</style>
</head>
<body>

<!-- Floating Orbs -->
<div class="orb" style="top: -80px; left: -80px;"></div>
<div class="orb orb2" style="bottom: -60px; right: -60px;"></div>

<header>
    <h1>Admin Dashboard – Registrations</h1>
</header>

<div class="container">

    <!-- Chart Card -->
    <div class="card">
        <h2>Topic Interest Overview</h2>
        <canvas id="pieChart" height="200"></canvas>
    </div>

    <div class="card">
        <h2>Topic Count (Bar Chart)</h2>
        <canvas id="barChart" height="200"></canvas>
    </div>

    <!-- Registration Table -->
    <div class="card" style="grid-column: span 2;">
        <h2>All Registrations</h2>
        <div id="loading" class="loading">Loading registrations...</div>

        <table id="regTable" style="display:none;">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Topic</th>
                    <th>Submitted At</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

</div>

<script>
const API_URL = "https://backend-3hvk.onrender.com/registrations";

async function loadData() {
    try {
        const res = await fetch(API_URL);
        const data = await res.json();

        if (!Array.isArray(data)) {
            document.getElementById("loading").innerText = "Error loading data.";
            return;
        }

        document.getElementById("loading").style.display = "none";
        document.getElementById("regTable").style.display = "table";

        const tbody = document.querySelector("#regTable tbody");

        // Populate table
        data.forEach(r => {
            const row = `<tr>
                <td>${r.name}</td>
                <td>${r.email}</td>
                <td>${r.phone || "-"}</td>
                <td>${r.topic}</td>
                <td>${new Date(r.submittedAt).toLocaleString()}</td>
            </tr>`;
            tbody.innerHTML += row;
        });

        // Topic count for charts
        const topics = {};
        data.forEach(r => {
            topics[r.topic] = (topics[r.topic] || 0) + 1;
        });

        createCharts(topics);

    } catch (err) {
        console.error(err);
        document.getElementById("loading").innerText = "Failed to load data.";
    }
}

function createCharts(topics) {
    const labels = Object.keys(topics);
    const counts = Object.values(topics);

    const colors = ["#00c6ff", "#7b61ff", "#ff6b6b", "#ffd36b", "#60ffb8"];

    // Pie Chart
    new Chart(document.getElementById("pieChart"), {
        type: "pie",
        data: {
            labels,
            datasets: [{ data: counts, backgroundColor: colors }]
        }
    });

    // Bar Chart
    new Chart(document.getElementById("barChart"), {
        type: "bar",
        data: {
            labels,
            datasets: [{
                label: "Registrations",
                data: counts,
                backgroundColor: colors.map(c => c + "cc")
            }]
        },
        options: {
            scales: { y: { beginAtZero: true } }
        }
    });
}

loadData();
</script>

</body>
</html>
